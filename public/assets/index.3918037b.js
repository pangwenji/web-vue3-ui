import{g as c,o as k,i as $,m as l,I as u,c as j,l as q,z as M,A as P,d as V}from"./vendor.d1385716.js";import z from"./index.b6a06461.js";import{_ as G}from"./index.a83617fe.js";const J=r=>(M("data-v-41cf2d92"),r=r(),P(),r),L={class:"send-reply-box"},X=["placeholder"],F={class:"reply-control reply-box"},Q=["onClick"],W=J(()=>l("span",{style:{"margin-left":"6px"}},"\u6DFB\u52A0\u9644\u4EF6",-1)),Y=["onClick"],Z={props:{placeholder:{type:String,default:""}},setup(r,{emit:_}){const f=c(""),i=c("");c("");const v=c(""),h=c(""),a=c(!1),m=c({x:0,y:0});function E(){_("cancelReply")}const w=c("");function N(){if(f.value=w.value.innerText,f.value===""){V({message:"\u56DE\u590D\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",type:"warning",center:!0,"show-close":!0});return}_("sendReply",f)}function g(){return window.getSelection().focusOffset}function x(){return window.getSelection().focusNode}function R(){const n=window.getSelection().getRangeAt(0).getClientRects()[0],o=30;return{x:n.x,y:n.y+o}}function A(){const e=x();if(!e||e.nodeType!==Node.TEXT_NODE)return!1;const t=e.textContent||"",o=/@([^@\s]*)$/.exec(t.slice(0,g()));return o&&o.length===2}function B(){const e=x().textContent||"",n=/@([^@\s]*)$/.exec(e.slice(0,g()));if(n&&n.length===2)return n[1]}function I(e){const t=document.createElement("span");t.style.display="inline-block",t.dataset.user=JSON.stringify(e),t.className="at-button",t.contentEditable="false",t.textContent=`@${e.name}`;const n=document.createElement("span");n.style.display="inline-block",n.contentEditable="false";const o=document.createElement("span");o.style.whiteSpace="pre",o.textContent="\u200B",o.contentEditable="false";const s=o.cloneNode(!0);return n.appendChild(o),n.appendChild(t),n.appendChild(s),n}function T(e,t){return e.replace(/@([^@\s]*)$/,t)}function D(e){if(i&&e){const t=i.value.textContent||"",n=T(t.slice(0,v.value),""),o=t.slice(v.value),s=i.value.parentNode,d=i.value.nextSibling,C=new Text(n),p=new Text("\u200B"+o),S=I(e);s.removeChild(i.value),d?(s.insertBefore(C,d),s.insertBefore(S,d),s.insertBefore(p,d)):(s.appendChild(C),s.appendChild(S),s.appendChild(p));const y=new Range,b=window.getSelection();y.setStart(p,0),y.setEnd(p,0),b.removeAllRanges(),b.addRange(y)}}function U(){A()?(i.value=x(),v.value=g(),m.value=R(),h.value=B()||"",a.value=!0):a.value=!1}function O(e){a.value&&(e.code==="ArrowUp"||e.code==="ArrowDown"||e.code==="Enter")&&e.preventDefault()}function H(e){D(e),e.value=e,a.value=!1}function K(){a.value=!1}return(e,t)=>(k(),$("div",L,[l("div",{onClick:t[0]||(t[0]=u(()=>{},["stop"]))},[l("div",{class:"editor",ref_key:"divRef",ref:w,contenteditable:"",onKeyup:U,onKeydown:O,placeholder:r.placeholder},null,40,X)]),l("div",F,[l("div",null,[l("span",{onClick:t[1]||(t[1]=u(()=>{},["stop"]))},"@\u6210\u5458")]),l("div",null,[l("span",{onClick:u(E,["stop"])},"\u53D6\u6D88",8,Q),W,l("span",{onClick:u(N,["stop"]),style:{"margin-left":"6px"}},"\u53D1\u9001",8,Y)])]),a.value?(k(),j(z,{key:0,visible:a.value,position:m.value,queryString:h.value,onOnPickUser:H,onOnHide:K},null,8,["visible","position","queryString"])):q("",!0)]))}};var oe=G(Z,[["__scopeId","data-v-41cf2d92"]]);export{oe as default};
